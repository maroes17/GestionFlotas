<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
  crossorigin="anonymous"
  type="text/javascript"
></script>
<script
  src="https://code.jquery.com/jquery-3.7.1.js"
  type="text/javascript"
></script>
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"
  type="text/javascript"
></script>
<script
  src="https://cdn.datatables.net/2.2.2/js/dataTables.js"
  type="text/javascript"
></script>
<script
  src="https://cdn.datatables.net/2.2.2/js/dataTables.bootstrap5.js"
  type="text/javascript"
></script>
<script
  src="https://cdn.datatables.net/responsive/3.0.4/js/dataTables.responsive.js"
  type="text/javascript"
></script>
<script
  src="https://cdn.datatables.net/responsive/3.0.4/js/responsive.bootstrap5.js"
  type="text/javascript"
></script>
<script
  src="https://cdn.datatables.net/buttons/3.2.2/js/dataTables.buttons.js"
  type="text/javascript"
></script>
<script
  src="https://cdn.datatables.net/buttons/3.2.2/js/buttons.dataTables.js"
  type="text/javascript"
></script>
<script
  src="https://cdn.datatables.net/buttons/3.2.2/js/buttons.colVis.min.js"
  type="text/javascript"
></script>

<script>
  //Activar / Desactivar Botón Hamburguesa Menú
  const hamburger = document.querySelector("#toggle-btn");

  hamburger.addEventListener("click", function () {
    document.querySelector("#sidebar").classList.toggle("expand");
  });

  // Escuchar el click en los enlaces del menú
  document.querySelector("#flotaLink").addEventListener("click", function () {
    loadTableData("Flota"); // Llamamos a la función con el nombre de la hoja "Flota"
  });

  document
    .querySelector("#choferesLink")
    .addEventListener("click", function () {
      loadTableData("Choferes"); // Llamamos a la función con el nombre de la hoja "Choferes"
    });

  // Función para cargar los datos desde Google Sheets (con nombre de hoja)

  let currentSheetName = ""; // Variable para saber la hoja actual
  let dataTableInstance = null;

  function loadTableData(sheetName) {
    currentSheetName = sheetName;

    // Mostrar el header
    const header = document.getElementById("table-header");
    header.style.display = "flex";

    // Actualizar el título
    document.getElementById("currentSectionTitle").textContent = sheetName;

    // Limpiar los botones si ya existen
    const actionsDiv = document.getElementById("action-buttons");
    actionsDiv.innerHTML = "";

    // Crear botón Refresh
    const refreshBtn = document.createElement("button");
    refreshBtn.className = "btn btn-outline-primary btn-sm me-2";
    refreshBtn.innerHTML = '<i class="bi bi-arrow-clockwise"></i> Refresh';
    refreshBtn.onclick = () => {
      loadTableData(currentSheetName);
    };

    // Crear botón Agregar
    const addNewBtn = document.createElement("button");
    addNewBtn.className = "btn btn-outline-success btn-sm";
    addNewBtn.innerHTML = '<i class="bi bi-plus-circle"></i> Agregar';
    addNewBtn.onclick = () => {
      alert("Agregar nuevo contacto en: " + currentSheetName);
      // Aquí podrías abrir un modal o algo más elegante después
    };

    // Agregar botones al div
    actionsDiv.appendChild(refreshBtn);
    actionsDiv.appendChild(addNewBtn);

    // Finalmente cargar los datos de la tabla
    google.script.run
      .withSuccessHandler(function (object) {
        updateTable(object.headers, object.datos);
      })
      .getData(sheetName);
  }

  function updateTable(headers, data) {
    // Destruir la tabla anterior si existe
    if (dataTableInstance !== null) {
      dataTableInstance.destroy();
      document.getElementById("tablaPrueba").innerHTML =
        "<thead></thead><tbody></tbody>"; // Limpiar tabla
    }

    // Formatear las columnas
    const formattedCols = headers.map((header) => {
      return { title: header };
    });

    // Crear nueva tabla
    dataTableInstance = new DataTable("#tablaPrueba", {
      responsive: true,
      layout: {
        topStart: {
          buttons: [
            {
              extend: "colvis",
              text: "Columnas",
            },
          ],
        },
      },
      language: {
        url: "//cdn.datatables.net/plug-ins/2.2.2/i18n/es-CL.json",
      },
      columns: formattedCols,
      data: data,
    });
  }
</script>
